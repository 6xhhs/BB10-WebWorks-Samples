/*
 *  Copyright 2012 Research In Motion Limited.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var define,require;(function(){function hasValidExtension(a){return ACCEPTABLE_EXTENSIONS.some(function(b,c,d){return a.match("\\"+b+"$")})}function normalizeName(a,b){var c,d=a.slice(0);d=d.replace(/(?:^local:\/\/)/,"");if(d.charAt(0)==="."&&b){c=b.split("/");c.pop();c=c.concat(d.split("/"));d=c.reduce(function(a,b,c,d){var e,f;if(a!=="."){e=a}if(b===".."){f=a.lastIndexOf("/");if(f!==-1){e=a.slice(0,a.lastIndexOf("/"))}else{e=""}}else if(b!=="."){if(e.length){e+="/"}e+=b}return e})}if(!hasValidExtension(d)){d=d+DEFAULT_EXTENSION}return d}function buildModule(a,b,c){var d={exports:{}},e=function(b){return require(b,a)},f=[];e.toUrl=function(b,c){return require.toUrl(b,c||a)};b.forEach(function(a){if(a==="require"){f.push(e)}else if(a==="exports"){f.push(d.exports)}else if(a==="module"){f.push(d)}else{f.push(loadModule(a))}});c.apply(this,f);return d.exports}function getDefineString(a,b){var c='define("'+a+'", function (require, exports, module) {',d=/\.json$/.test(a);c+=d?" module.exports = ":"";c+=b.replace(/^\s+|\s+$/g,"");c+=d?" ;":"";c+="});";return c}function loadModule(name,baseName){var normalizedName=normalizeName(name,baseName),url,xhr,loadResult;if(unpreparedModules[normalizedName]){readyModules[normalizedName]=buildModule(normalizedName,unpreparedModules[normalizedName].dependencies,unpreparedModules[normalizedName].factory);delete unpreparedModules[normalizedName]}if(!readyModules[normalizedName]){if(hasValidExtension(name)||baseName){xhr=new XMLHttpRequest;url=name;if(/^local:\/\//.test(name)){url="http://localhost:8472/extensions/load/"+normalizedName.replace(/(?:^ext\/)(.+)(?:\/client.js$)/,"$1");xhr.open("GET",url,false);xhr.send(null);try{loadResult=JSON.parse(xhr.responseText);loadResult.dependencies.forEach(function(dep){eval(getDefineString(dep.moduleName,dep.body))});eval(getDefineString(normalizedName,loadResult.client))}catch(err1){err1.message+=" in "+url;throw err1}}else{if(baseName){url=normalizedName}xhr.open("GET",url,false);xhr.send(null);try{eval(getDefineString(normalizedName,xhr.responseText))}catch(err){err.message+=" in "+url;throw err}}if(unpreparedModules[normalizedName]){readyModules[normalizedName]=buildModule(normalizedName,unpreparedModules[normalizedName].dependencies,unpreparedModules[normalizedName].factory);delete unpreparedModules[normalizedName]}}else{throw"module "+name+" cannot be found"}}return readyModules[normalizedName]}var unpreparedModules={},readyModules={},ACCEPTABLE_EXTENSIONS=[".js",".json"],DEFAULT_EXTENSION=".js";require=function(a,b){if(typeof a==="string"){return loadModule(a,b)}else if(Array.isArray(a)&&typeof b==="function"){setTimeout(function(){buildModule(undefined,a,b)},0)}};require.toUrl=function(a,b){return normalizeName(a,b)};define=function(a,b,c){if(typeof a==="string"&&typeof b==="function"){c=b;b=["require","exports","module"]}a=normalizeName(a);unpreparedModules[a]={dependencies:b,factory:c}}})();if(typeof module==="object"&&typeof require==="function"){module.exports={require:require,define:define}}define("builder",function(a,b,c){function e(a,b,c){var f,g;if(b.length===1){f=b[0];if(a[f]===undefined){a[f]={}}a=d.mixin(c,a[f]);return a}else{g=b.shift();if(a[g]===undefined){a[g]={}}return e(a[g],b,c)}}function f(a,b){var c,f,g,h;for(h=0;h<b.length;h++){c=b[h];g="local://ext/"+c+"/client.js";f=d.loadModule(g);e(a,c.split("."),f)}}var d=a(!!a.resolve?"../utils":"lib/utils");var g={build:function(a){return{into:function(b){f(b,a)}}}};c.exports=g});define("window",function(a,b,c){c.exports={window:function(){return!!a.resolve?null:window}}});define("event",function(a,b,c){function e(a,b,c,e,f,g){var h;if(a&&b&&typeof c==="function"){h={func:c,once:!!g};if(!d.hasOwnProperty(b)){d[b]=[h];if(!g){window.webworks.exec(e,f,a,"add",{eventName:b})}}else if(!d[b].some(function(a,b,d){return a.func===c})){d[b].push(h)}}}var d={};c.exports={add:function(a,b,c,d,f){e(a,b,c,d,f,false)},once:function(a,b,c,d,f){e(a,b,c,d,f,true)},isOn:function(a){return!!d[a]},remove:function(a,b,c,e,f){if(a&&b&&typeof c==="function"){if(d.hasOwnProperty(b)){d[b]=d[b].filter(function(a,b,d){return a.func!==c||a.once});if(d[b].length===0){delete d[b];window.webworks.exec(e,f,a,"remove",{eventName:b})}}}},trigger:function(a,b){var c;if(d.hasOwnProperty(a)){if(b&&b!=="undefined"){c=JSON.parse(decodeURIComponent(b))}d[a].forEach(function(a){if(a){a.func.apply(undefined,c)}});d[a]=d[a].filter(function(a){return!a.once});if(d[a].length===0){delete d[a]}}}}});define("lib/utils",function(a,b,c){function f(){return((1+Math.random())*65536|0).toString(16).substring(1)}var d,e=a("./exception");d=c.exports={validateNumberOfArguments:function(a,b,c,d,f,g){f=f||"";if(arguments.length<3||arguments.length>6){e.raise(e.types.Argument,"Wrong number of arguments when calling: validateNumberOfArguments()")}if(isNaN(a)&&isNaN(b)&&isNaN(c)){e.raise(e.types.ArgumentType,"(validateNumberOfArguments) Arguments are not numbers")}a=parseInt(a,10);b=parseInt(b,10);c=parseInt(c,10);if(c<a||c>b){e.raise(d||e.types.ArgumentLength,f+"\n\nWrong number of arguments",g)}},validateArgumentType:function(a,b,c,d,f){var g=false,h;switch(b){case"array":if(!a instanceof Array){g=true}break;case"date":if(!a instanceof Date){g=true}break;case"integer":if(typeof a==="number"){if(a!==Math.floor(a)){g=true}}else{g=true}break;default:if(typeof a!==b){g=true}break}if(g){h=d+("\n\nInvalid Argument type. argument: "+a+" ==> was expected to be of type: "+b);e.raise(c||e.types.ArgumentType,h,f)}},validateMultipleArgumentTypes:function(a,b,c,d,e){for(var f=0;f<a.length;f++){this.validateArgumentType(a[f],b[f],c,d,e)}},arrayContains:function(a,b){var c=a.length;while(c--){if(a[c]===b){return true}}return false},some:function(a,b,c){if(a instanceof Array){return a.some(b,c)}else{var e=d.map(a,b,c);return d.reduce(e,function(a,b){return b?b:a},false)}},count:function(a){return d.sum(a,function(a){return 1})},sum:function(a,b,c){var e=d.map(a,b,c);return d.reduce(e,function(a,b){return a+b})},max:function(a,b,c){var e=d.map(a,b,c);return d.reduce(e,function(a,b){return a<b?b:a},Number.MIN_VALUE)},min:function(a,b,c){var e=d.map(a,b,c);return d.reduce(e,function(a,b){return a>b?b:a},Number.MAX_VALUE)},forEach:function(a,b,c){if(a instanceof Array){return a.forEach(b,c)}else{d.map(a,b,c)}},filter:function(a,b,c){if(a instanceof Array){return a.filter(b,c)}else{var e=[];d.forEach(a,function(a,d){if(b.apply(c,[a,d])){e.push(a)}},c);return e}},reduce:function(a,b,c,d){var e,f=c===undefined?0:c,g=f;if(a instanceof Array){return a.reduce(b,f)}else if(a instanceof NamedNodeMap){for(e=0;e<a.length;e++){g=b.apply(d,[g,a[e],e])}}else{for(e in a){if(a.hasOwnProperty(e)){g=b.apply(d,[g,a[e],e])}}}return g},map:function(a,b,c){var d,e=null,f=[];if(a instanceof Array){return a.map(b,c)}else if(a instanceof NamedNodeMap){for(d=0;d<a.length;d++){e=b.apply(c,[a[d],d]);f.push(e)}}else{for(d in a){if(a.hasOwnProperty(d)){e=b.apply(c,[a[d],d]);f.push(e)}}}return f},series:function(a,b){var c=function(){var d=[],e;if(a.length){e=a.shift();d=d.concat(e.args).concat(c);e.func.apply(this,d)}else{b.func.apply(this,b.args)}};c()},regexSanitize:function(a){return a.replace("^","\\^").replace("$","\\$").replace("(","\\(").replace(")","\\)").replace("<","\\<").replace("[","\\[").replace("{","\\{").replace(/\\/,"\\\\").replace("|","\\|").replace(">","\\>").replace(".","\\.").replace("*","\\*").replace("+","\\+").replace("?","\\?")},find:function(a,b,c,e,f){var g=[],h=function(a,b){if(typeof a!=="string"||b===null){return a===b}var c=b.replace(/\./g,"\\.").replace(/\^/g,"\\^").replace(/\*/g,".*").replace(/\\\.\*/g,"\\*");c="^".concat(c,"$");return!!a.match(new RegExp(c,"i"))};d.forEach(b,function(b){var c,e=false;d.forEach(a,function(a,d){if(!e&&a!==undefined){if(h(b[d],a)){c=b}else{e=true;c=null}}});if(c){g.push(c)}});if(f){if(c===undefined){c=0}if(e===undefined){e=g.length}if(c===e){e=c+1}f.apply(null,[g.slice(c,e)])}},mixin:function(a,b){Object.getOwnPropertyNames(a).forEach(function(c){if(Object.hasOwnProperty.call(a,c)){Object.defineProperty(b,c,Object.getOwnPropertyDescriptor(a,c))}});return b},copy:function(a){var b,c=(a===null?false:global.toString.call(a)==="[object Array]")?[]:{};if(typeof a==="number"||typeof a==="string"||typeof a==="boolean"||a===null||a===undefined){return a}if(a instanceof Date){return new Date(a)}if(a instanceof RegExp){return new RegExp(a)}for(b in a){if(a.hasOwnProperty(b)){if(a[b]&&typeof a[b]==="object"){if(a[b]instanceof Date){c[b]=a[b]}else{c[b]=d.copy(a[b])}}else{c[b]=a[b]}}}return c},startsWith:function(a,b){return a.indexOf(b)===0},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)!==-1},parseUri:function(a){var b,c={},d=["source","scheme","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(a);for(b=d.length-1;b>=0;b--){c[d[b]]=e[b]||""}return c},isAbsoluteURI:function(a){if(a&&a.source){return a.relative!==a.source}return false},fileNameToImageMIME:function(a){var b={},c;b.png="image/png";b.jpg="image/jpeg";b.jpe="image/jpeg";b.jpeg="image/jpeg";b.gif="image/gif";b.bmp="image/bmp";b.bm="image/bmp";b.svg="image/svg+xml";b.tif="image/tiff";b.tiff="image/tiff";c=a.split(".").pop();return b[c]},isLocalURI:function(a){return a&&a.scheme&&"local:///".indexOf(a.scheme.toLowerCase())!==-1},isFileURI:function(a){return a&&a.scheme&&"file://".indexOf(a.scheme.toLowerCase())!==-1},isHttpURI:function(a){return a&&a.scheme&&"http://".indexOf(a.scheme.toLowerCase())!==-1},isHttpsURI:function(a){return a&&a.scheme&&"https://".indexOf(a.scheme.toLowerCase())!==-1},isDataURI:function(a){return a&&a.scheme&&"data:".indexOf(a.scheme.toLowerCase())!==-1},performExec:function(a,b,c){var d;window.webworks.exec(function(a,b){d=a},function(a,b){throw a},a,b,c,true);return d},inNode:function(){return!!a.resolve},requireWebview:function(){return a("./webview")},convertDataToBinary:function(a,b){var c,d,e;if(a){if(b.toLowerCase()==="base64"){c=window.atob(a)}else{c=a}d=new Uint8Array(new ArrayBuffer(c.length));for(e=0;e<d.length;e++){d[e]=c.charCodeAt(e)}return d.buffer}},getBlobWithArrayBufferAsData:function(a,b){var c,d=new window.WebKitBlobBuilder;c=this.convertDataToBinary(a,b);d.append(c);return d.getBlob("arraybuffer")},loadModule:function(b){return a(b)},loadExtensionModule:function(b,c){var d=a("./manifest")[b];if(d){return a("../ext/"+d.namespace+"/"+c)}else{return null}},hasPermission:function(a,b){if(a&&a.permissions&&a.permissions.length){return a.permissions.indexOf(b)>=0}return false},guid:function(){return f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()},getURIPrefix:function(){return"http://localhost:8472/"}}});define("lib/exception",function(a,b,c){c.exports={types:{Application:"Application",ArgumentLength:"ArgumentLength",ArgumentType:"ArgumentType",Argument:"Argument",NotificationType:"NotificationType",NotificationStateType:"NotificationStateType",DomObjectNotFound:"DomObjectNotFound",MethodNotImplemented:"MethodNotImplemented",InvalidState:"InvalidState",ApplicationState:"ApplicationState"},handle:function(b,c){c=c||false;var d=b.message||"exception caught!",e=d+"\n\n"+(b.stack||"*no stack provided*")+"\n\n";console.error(e);if(c){throw b}},raise:function(b,c,d){var e=d||{type:"",message:"",toString:function(){var a=this.name+': "'+this.message+'"';if(this.stack){a+="\n"+this.stack}return a}};c=c||"";e.name=b;e.type=b;e.message=c;throw e}}});define("lib/webworks-info",function(a,b,c){c.exports={hash:"0ce47be0f0e032b04d4c4ba14e243218",version:"1.0.2.9"}});(function(){function e(){if(d&&b&&!c){c=true;var a=document.createEvent("Events");a.initEvent("webworksready",true,true);document.dispatchEvent(a)}}function f(){function a(a){function c(){return require("lib/utils").getURIPrefix()+a}function d(a,b){var c=new XMLHttpRequest;c.open("POST",a,b);c.setRequestHeader("Content-Type","application/json");return c}var b={};this.addParam=function(a,c){b[a]=encodeURIComponent(JSON.stringify(c))};this.makeSyncCall=function(a,e){var f=c(),g=d(f,false),h,i,j,k;g.send(JSON.stringify(b));h=JSON.parse(decodeURIComponent(g.responseText)||"null");i=h.code<0;j=i?e:a;k=i?h.msg:h.data;if(j){j(k,h)}else if(i){throw k}return k};this.makeAsyncCall=function(a,e){var f=c(),g=d(f,true);g.onreadystatechange=function(){if(g.readyState===4&&g.status===200){var b=JSON.parse(decodeURIComponent(g.responseText)||"null"),c=b.code<0?e:a,d=b.code<0?b.msg:b.data;return c&&c(d,b)}};g.send(JSON.stringify(b))}}var c,d,f,g,h=require("lib/webworks-info");if(window.blackberry){b=true;e();return}c=require("builder");d=new XMLHttpRequest;d.open("GET","http://localhost:8472/extensions/get/?hash="+h.hash+"&version="+h.version,true);d.onreadystatechange=function(){if(d.readyState===4){f=JSON.parse(decodeURIComponent(d.responseText));if(d.status===412){alert(f.msg)}else if(d.status===200){c.build(f.data).into(window);b=true;e()}}};d.send(null);g=function(b,c,d,e,f,g){var h=d+"/"+e,i=new a(h),j;for(j in f){if(Object.hasOwnProperty.call(f,j)){i.addParam(j,f[j])}}i[g?"makeSyncCall":"makeAsyncCall"](b,c)};window.webworks={exec:g,execSync:function(a,b,c){var d;g(function(a,b){d=a},function(a,b){throw a},a,b,c,true);return d},execAsync:function(a,b,c){var d;g(function(a,b){d=a},function(a,b){throw a},a,b,c,false);return d},successCallback:function(a,b){throw"not implemented"},errorCallback:function(a,b){throw"not implemented"},defineReadOnlyField:function(a,b,c){Object.defineProperty(a,b,{value:c,writable:false})},event:require("event")}}var a=document.addEventListener,b=false,c=false,d=false;document.addEventListener=function(b,c,f){a.call(document,b,c,f);if(b.toLowerCase()==="webworksready"){d=true;e()}};document.addEventListener("DOMContentLoaded",f,false);if(document.readyState==="complete"){f()}})()})()